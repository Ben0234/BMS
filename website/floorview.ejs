<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <%- include("./header") %>
  </head>

  <body>
    <img
      src=""
      alt=""
      id="floorplan"
      style="position: absolute; top: 0; left: 0"
      usemap="#testmap"
    />
    <button onclick="increaseTemp()">Increase temperature</button>
    <canvas style="width: 600px; height: 400px"></canvas>
    <map name="testmap" id="testmap">
      <area shape="rect" id="rect1" coords="0,0,100,100" href="" alt="" />
    </map>

    <script>
        var temp = [23,24,29]
        var zones;  // Ensure zones is defined
        var imagemap = document.getElementById("testmap");
        var ejsData = <%- JSON.stringify(data) %>;
        var floorplan = ejsData[0].floorplan;
        var image = document.querySelector("img");
        image.src = floorplan;
        zones = ejsData[0].zones;
        function createArea() {
          for (var zone in zones) {  // Use var to declare the loop variable
            var coordinates = zones[zone];
            var area = document.createElement("area");
            area.setAttribute("shape", "rect");
            area.setAttribute(
              "coords",
              coordinates.startX +
                "," +
                coordinates.startY +
                "," +
                coordinates.endX +
                "," +
                coordinates.endY
            );
            area.setAttribute("href", "#"); // Set the href attribute as needed
            area.setAttribute("id", zones[zone].name);
            imagemap.appendChild(area);
            console.log(zone, "mapped!");
          }
        }

        function increaseTemp() {
            temp[0] += 1;
            updatetemperature()
        }

        $("img").mapster({
          showToolTip: true,
          mapKey: "id",
          areas: [
            {
              key: "rect1",
              toolTip: "test tooltip",
            },
          ],
        });
        function updatetemperature(){
        for (var zone in zones) {  // Use var to declare the loop variable
          var areaOptions = {
            key: zones[zone].name,
            toolTip: "temperature is " + temp[zone] +"C"
          };
          $("img").mapster('set_options', {  // Fix the selector to "img"
            areas: [
              {
                key: areaOptions.key,
                toolTip: areaOptions.toolTip,
              },
            ],
          });
          console.log(areaOptions);
        }
      }
      createArea();
      updatetemperature();
    </script>
  </body>
</html>
